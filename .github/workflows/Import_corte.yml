name: Ejecutar Scrapers

on:
  workflow_dispatch:        # Permite ejecutar manualmente con el bot√≥n "Run workflow"
  schedule:
    - cron: '0 20 * * *'  # Ejecuta autom√°ticamente a las 8:00, 14:00 y 20:00 UTC

jobs:
  scraping-job:
    runs-on: ubuntu-latest
    timeout-minutes: 60      # Evita que se quede colgado consumiendo minutos

    steps:
      # 1. Descargar el c√≥digo del repositorio
      - name: üì• Checkout del c√≥digo
        uses: actions/checkout@v4

      # 2. Configurar Python
      - name: üêç Configurar Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # Cacha las dependencias para ir m√°s r√°pido

      # 3. Instalar librer√≠as necesarias
      - name: üì¶ Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 woocommerce curl_cffi lxml

      # ----------------------------------------------------------------
      # EJECUCI√ìN DE SCRIPTS (Cada uno con sus secretos)
      # ----------------------------------------------------------------

      # Script 1: Phone House
      - name: üì± Ejecutar Phone House
        env:
          WP_URL: ${{ secrets.WP_URL }}
          WP_KEY: ${{ secrets.WP_KEY }}       # O WC_KEY, revisa tus secretos
          WP_SECRET: ${{ secrets.WP_SECRET }} # O WC_SECRET
          # A√±ade aqu√≠ otras variables si phonehouse.py las necesita
        run: python phonehouse.py
        continue-on-error: true  # Si falla, contin√∫a con el siguiente

      # Script 2: Compras Smartphone
      - name: üõí Ejecutar Compras Smartphone
        env:
          WP_URL: ${{ secrets.WP_URL }}
          WP_KEY: ${{ secrets.WP_KEY }}
          WP_SECRET: ${{ secrets.WP_SECRET }}
          SOURCE_URL_COMPRAS: ${{ secrets.SOURCE_URL_COMPRAS }}
          COMPRAS_URLS: ${{ secrets.COMPRAS_URLS }}
          AFF_ALIEXPRESS: ${{ secrets.AFF_ALIEXPRESS }}
          AFF_MEDIAMARKT: ${{ secrets.AFF_MEDIAMARKT }}
          AFF_AMAZON: ${{ secrets.AFF_AMAZON }}
          AFF_FNAC: ${{ secrets.AFF_FNAC }}
        run: python compras.py
        continue-on-error: true

      # Script 3: El Corte Ingl√©s
      - name: üè¢ Ejecutar El Corte Ingl√©s
        env:
          # No necesita WP_URL porque est√° en modo DRY_RUN (solo logs)
          AFF_ELCORTEINGLES: ${{ secrets.AFF_ELCORTEINGLES }}
          START_URL_CORTEINGLES: ${{ secrets.START_URL_CORTEINGLES }}
          CORTEINGLES_URLS: ${{ secrets.CORTEINGLES_URLS }}
        run: python corte.py
        continue-on-error: true

      # Opcional: Listar archivos si algo falla para depurar
      - name: üìÇ Listar archivos (Debug)
        if: failure()
        run: ls -R
