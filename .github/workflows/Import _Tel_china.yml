name: Import Tel_china

on:
  schedule:
    - cron: '00 10,16,22 * * *'
  workflow_dispatch:
  
  # --- SOLUCI√ìN AL ERROR 403 ---
permissions:
  actions: write
  contents: read
# -----------------------------

jobs:
  ejecutar-scraper:
    runs-on: ubuntu-latest

    steps:
    - name: Descargar c√≥digo
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Instalar librer√≠as
      run: |
        python -m pip install --upgrade pip
        # Instalamos las librer√≠as que usa tu script
        pip install requests beautifulsoup4 woocommerce lxml

    - name: Ejecutar Script
      env:
        # Aqu√≠ inyectamos los secretos que ya creaste
        WP_URL: ${{ secrets.WP_URL }}
        WP_KEY: ${{ secrets.WP_KEY }}
        WP_SECRET: ${{ secrets.WP_SECRET }}
        AFF_ALIEXPRESS: ${{ secrets.AFF_ALIEXPRESS }}
        AFF_MEDIAMARKT: ${{ secrets.AFF_MEDIAMARKT }}
        AFF_AMAZON: ${{ secrets.AFF_AMAZON }}
        AFF_FNAC: ${{ secrets.AFF_FNAC }}
        AFF_XIAOMI_STORE: ${{ secrets.AFF_XIAOMI_STORE }}
        AFF_PHONEHOUSE: ${{ secrets.AFF_PHONEHOUSE }}
        AFF_TRADINGSENZHEN: ${{ secrets.AFF_TRADINGSENZHEN }}
        AFF_DHGATE: ${{ secrets.AFF_DHGATE }}
        AFF_ELCORTEINGLES: ${{ secrets.AFF_ELCORTEINGLES }}    
          
        
      run: python Tel_china.py

    # --- LIMPIEZA AUTOM√ÅTICA ---
    - name: üßπ Borrar historiales antiguos
      uses: Mattraks/delete-workflow-runs@v2
      with:
        token: ${{ github.token }}
        repository: ${{ github.repository }}
        retain_days: 7       # Mantiene solo 1 semana de historial
        keep_minimum_runs: 6 # Guarda m√≠nimo las √∫ltimas 6 ejecuciones por seguridad
