name: Smart-GSM → Specs a Subcategorías

on:
  workflow_dispatch:
    inputs:
      overwrite:
        description: "1 = sobrescribe descripciones existentes, 0 = no pisa si ya hay"
        required: false
        default: "0"
      sleep:
        description: "Pausa entre requests a Smart-GSM (segundos)"
        required: false
        default: "0.8"

  schedule:
    # 1 vez al día (UTC). Ajusta si quieres otro horario.
    #- cron: "5 6 * * *"
    - cron: "5 18 * * *"

concurrency:
  group: smartgsm-specs
  cancel-in-progress: true

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 unidecode woocommerce

      - name: Run Smart-GSM importer
        env:
          WP_URL: ${{ secrets.WP_URL }}
          WP_KEY: ${{ secrets.WP_KEY }}
          WP_SECRET: ${{ secrets.WP_SECRET }}
          SMARTGSM_OVERWRITE: ${{ github.event.inputs.overwrite || '0' }}
          SMARTGSM_SLEEP: ${{ github.event.inputs.sleep || '0.8' }}
        run: |
          echo "Running smartgsm_specs.py..."
          python smartgsm_specs.py
